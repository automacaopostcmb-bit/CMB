<!DOCTYPE html>
<html lang="pt-BR">
<head>

  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<meta charset="UTF-8" />
<title>Área Restrita</title>
<style>
  /* Centraliza tudo na tela */
html, body { height: 100%; }
body {
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
  justify-content: center;      /* vertical */
  align-items: center;          /* horizontal */
  min-height: 100dvh;           /* melhor que 100vh em mobile */
  margin: 0;
  padding: 24px;                /* respiro nas bordas */
}

/* Títulos */
h2, h3 { margin: 0 0 14px 0; text-align: center; }

/* Campos e botões – tamanhos confortáveis no toque */
input, button {
  display: block;
  margin: 10px 0;
  padding: 12px;
  width: 100%;
  max-width: 420px;             /* mais largo no celular */
  font-size: 16px;              /* evita zoom do iOS */
  box-sizing: border-box;
}

/* Containers */
#menu, #loading {
  width: 100%;
  max-width: 420px;             /* acompanha inputs/botões */
}
#menu { display: none; }
#loading { display: none; }

/* “Sair” como link pequeno */
#linkSair {
  cursor: pointer;
  color: #007bff;
  text-align: center;
  font-size: 14px;
  margin-top: 16px;
  user-select: none;
}
#linkSair:hover { text-decoration: underline; }

/* Centraliza o texto de loading */
#loading p { text-align: center; margin: 0; }

/* Em telas maiores, dá uma afinada para não ficar gigante */
@media (min-width: 768px) {
  input, button, #menu, #loading { max-width: 480px; }
}

</style>
</head>
<body>

  <h2 id="tituloLogin">Login</h2>

  <div id="login-area">
    <input type="email" id="email" placeholder="Digite seu e-mail" />
    <button id="btnEntrar" onclick="login()">Entrar</button>
  </div>

  <!-- BLOCO DE LOADING (único visível durante a busca) -->
  <div id="loading">
    <p>Carregando páginas…</p>
  </div>

  <!-- MENU SÓ APARECE DEPOIS QUE AS PÁGINAS FOREM CARREGADAS -->
  <div id="menu">
    <h3>Páginas disponíveis</h3>
    <div id="botoes"></div>
    <p id="linkSair" onclick="logout()">Sair</p>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbye8ZvyXrk86SpfuYxXXM9U3vdS8FC4tIb-SDdMf53DvLwC7T2t2YM0SkRffiE2Q-BYfw/exec";

const paginas = [
  {nome: "area_artistas",        label: "Área dos Artistas"},
  {nome: "expo_business",        label: "Expositor Área Business"},
  {nome: "expo_market",          label: "Expositor Área Market"},
  {nome: "cadastro_masterclass", label: "Cadastro Masterclass"},
  {nome: "cadastro_lancamento",  label: "Cadastro de Lançamento"},
];

let isLoading = false;

function setLoading(state) {
  isLoading = state;
  const btn = document.getElementById("btnEntrar");
  if (btn) {
    btn.disabled = state;
    btn.textContent = state ? "Carregando..." : "Entrar";
  }
}

document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const isBack = params.get("back") === "1";

  const email = (localStorage.getItem("email") || "").toLowerCase().trim();

  if (isBack && email) {
    // Veio de uma página interna: mantém email e carrega menu direto
    document.getElementById("tituloLogin").style.display = "none";
    document.getElementById("login-area").style.display = "none";
    carregarMenu();
  } else {
    // Fluxo normal: força novo login num acesso "frio"
    localStorage.removeItem("email");
    document.getElementById("menu").style.display = "none";
    document.getElementById("botoes").innerHTML = "";
    // Enter no campo de e-mail dispara login
    document.getElementById("email").addEventListener("keydown", (e) => {
      if (e.key === "Enter") login();
    });
  }
});


function login() {
  const email = document.getElementById("email").value.trim().toLowerCase();
  if (!email) return alert("Digite um e-mail.");
  localStorage.setItem("email", email);
  carregarMenu();
}

function logout() {
  localStorage.removeItem("email");
  setLoading(false);
  document.getElementById("menu").style.display = "none";
  document.getElementById("botoes").innerHTML = "";
  document.getElementById("email").value = "";
  document.getElementById("tituloLogin").style.display = "block";
  document.getElementById("login-area").style.display = "block";
  // remove o parâmetro back da URL
  if (window.location.search.includes("back=1")) {
    window.history.replaceState({}, "", "index.html");
  }
}


async function carregarMenu() {
  if (isLoading) return;
  const email = localStorage.getItem("email");
  if (!email) return;

  setLoading(true);

  const titulo = document.getElementById("tituloLogin");
  const loginArea = document.getElementById("login-area");
  const menu = document.getElementById("menu");
  const area = document.getElementById("botoes");
  const loading = document.getElementById("loading");

  // Durante o carregamento, mostra só o bloco de loading
  titulo.style.display = "none";
  loginArea.style.display = "none";
  menu.style.display = "none";
  loading.style.display = "block";

  try {
    const resp = await fetch(`${API_URL}?email=${encodeURIComponent(email)}`);
    const data = await resp.json();
    const perms = data.permissoes || {};

    area.innerHTML = "";

    let algumPermitido = false;
    paginas.forEach((pag) => {
      if (perms[pag.nome]) {
        algumPermitido = true;
        const btn = document.createElement("button");
        btn.textContent = pag.label;
        btn.addEventListener("click", () => {
          window.location.href = `${pag.nome}.html`;
        }, { once: true });
        area.appendChild(btn);
      }
    });

    // Terminou: esconde loading
    loading.style.display = "none";

    if (algumPermitido) {
      menu.style.display = "block";   // agora sim mostra o menu e o “Sair”
    } else {
      alert("Acesso inválido.");
      logout();
    }

  } catch (err) {
    console.error(err);
    alert("Erro ao carregar. Tente novamente.");
    loading.style.display = "none";
    logout();
  } finally {
    setLoading(false);
  }
}
</script>

</body>
</html>
